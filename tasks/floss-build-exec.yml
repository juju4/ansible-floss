---

- name: git clone floss
  git:
    repo: https://github.com/fireeye/flare-floss.git
    dest: "{{ toolsetdir }}/floss"
    version: "{{ floss_version }}"

- name: install floss executable build dependencies
  apt:
    name: libpython2.7-dev
    state: present
  when: ansible_distribution_release == 'trusty'
  register: pkg_result
  until: pkg_result is success

- name: install floss executable build pip dependencies
  pip:
    name: pyinstaller
    state: present
    executable: pip3
  register: pkg_result
  until: pkg_result is success

- name: build floss executable with pyinstaller
  command: "pyinstaller floss.spec"
  args:
    creates: dist/floss
    chdir: "{{ toolsetdir }}/floss"

- name: install floss executable
  copy:
    src: "{{ toolsetdir }}/floss/dist/floss"
    dest: /usr/local/bin/floss
    mode: '0755'
    remote_src: yes
