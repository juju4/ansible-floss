---

- name: git clone floss
  git:
    repo: https://github.com/fireeye/flare-floss.git
    dest: "{{ toolsetdir }}/floss"
    version: "{{ floss_version }}"

- name: install floss executable build dependencies
  apt: name={{ item }} state=present
  with_items:
    - libpython2.7-dev
  when: ansible_distribution_release == 'trusty'

- name: install floss executable build pip dependencies
  pip: name={{ item }} state=present
  with_items:
    - pyinstaller

- name: build floss executable with pyinstaller
  command: "pyinstaller floss.spec"
  args:
    creates: dist/floss
    chdir: "{{ toolsetdir }}/floss"

- name: install floss executable
  copy:
    src: "{{ toolsetdir }}/floss/dist/floss"
    dest: /usr/local/bin/floss
    mode: '0755'
    remote_src: yes
